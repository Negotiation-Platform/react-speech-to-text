import{useState as e,useRef as t,useEffect as n}from"react";var o=function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function r(e,t,n,o){return new(n||(n=Promise))((function(r,a){function i(e){try{l(o.next(e))}catch(e){a(e)}}function s(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((o=o.apply(e,t||[])).next())}))}function a(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,o=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(r=i.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function i(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,r++)o[r]=a[i];return o}var s,l=c;function c(){}c.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,n){this.callbacks=this.callbacks||{};var o=3===arguments.length,r=o?arguments[1]:void 0,a=o?arguments[2]:arguments[1];return a._groupName=r,(this.callbacks[e]=this.callbacks[e]||[]).push(a),this},t.once=function(e,t,n){var o=this,r=3===arguments.length,a=r?arguments[1]:void 0,i=r?arguments[2]:arguments[1];function s(){o.off(e,s),i.apply(this,arguments)}return this.on(e,a,s),this},t.releaseGroup=function(e){var t,n,o,r;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(n=0,o=(r=this.callbacks[t]).length;n<o;n++)r[n]._groupName===e&&(r.splice(n,1),n--,o--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var n,o=this.callbacks[e];return o?1===arguments.length?(delete this.callbacks[e],this):(-1!==(n=o.indexOf(t))&&(o.splice(n,1),0===o.length&&delete this.callbacks[e]),this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,n,o,r=[].slice.call(arguments,1),a=this.callbacks[e],i=this.getWildcardCallbacks(e);if(a)for(t=0,n=(o=a.slice()).length;t<n&&o[t];++t)o[t].apply(this,r);if(i)for(n=i.length,t=0,n=(o=i.slice()).length;t<n&&o[t];++t)o[t].apply(this,[e].concat(r));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,n,o=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[0].length)===n[0])&&(o=o.concat(this.callbacks[t]));return o}},c.mixin(c),"undefined"!=typeof window&&(s=window.AudioContext||window.webkitAudioContext);var u=null,f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},h=!!(f===f.window&&f.URL&&f.Blob&&f.Worker);function p(e,t){var n,o=this;if(t=t||{},h)return n=e.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],new f.Worker(f.URL.createObjectURL(new f.Blob([n],{type:"text/javascript"})));this.self=t,this.self.postMessage=function(e){setTimeout((function(){o.onmessage({data:e})}),0)},setTimeout(e.bind(t,t),0)}p.prototype.postMessage=function(e){var t=this;setTimeout((function(){t.self.onmessage({data:e})}),0)};var d=p;class g{constructor(e,t){this.config={bufferLen:4410,numChannels:1,mimeType:"audio/wav",...t},this.recording=!1,this.callbacks={getBuffer:[],exportWAV:[]},this.context=e.context,this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,this.config.bufferLen,this.config.numChannels,this.config.numChannels),this.node.onaudioprocess=e=>{if(this.recording){for(var t=[],n=0;n<this.config.numChannels;n++)t.push(e.inputBuffer.getChannelData(n));this.worker.postMessage({command:"record",buffer:t})}},e.connect(this.node),this.node.connect(this.context.destination);this.worker=new d((function(){let e,t,n,o=0,r=[];function a(){for(let e=0;e<t;e++)r[e]=[]}function i(e,t){let n=new Float32Array(t),o=0;for(let t=0;t<e.length;t++)n.set(e[t],o),o+=e[t].length;return n}function s(e,t,n){for(let o=0;o<n.length;o++)e.setUint8(t+o,n.charCodeAt(o))}this.onmessage=function(l){switch(l.data.command){case"init":c=l.data.config,e=c.sampleRate,t=c.numChannels,a(),n=e>44100?44100:e;break;case"record":!function(e){for(var n=0;n<t;n++)r[n].push(e[n]);o+=e[0].length}(l.data.buffer);break;case"exportWAV":!function(a){let l,c=[];for(let e=0;e<t;e++)c.push(i(r[e],o));l=2===t?function(e,t){let n=e.length+t.length,o=new Float32Array(n),r=0,a=0;for(;r<n;)o[r++]=e[a],o[r++]=t[a],a++;return o}(c[0],c[1]):c[0];let u=function(e){let o=new ArrayBuffer(44+2*e.length),r=new DataView(o);return s(r,0,"RIFF"),r.setUint32(4,36+2*e.length,!0),s(r,8,"WAVE"),s(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,t,!0),r.setUint32(24,n,!0),r.setUint32(28,4*n,!0),r.setUint16(32,2*t,!0),r.setUint16(34,16,!0),s(r,36,"data"),r.setUint32(40,2*e.length,!0),function(e,t,n){for(let o=0;o<n.length;o++,t+=2){let r=Math.max(-1,Math.min(1,n[o]));e.setInt16(t,r<0?32768*r:32767*r,!0)}}(r,44,e),r}(function(t,n){if(n==e)return t;if(n>e)throw"downsampling rate show be smaller than original sample rate";var o=e/n,r=Math.round(t.length/o),a=new Float32Array(r),i=0,s=0;for(;i<a.length;){for(var l=Math.round((i+1)*o),c=0,u=0,f=s;f<l&&f<t.length;f++)c+=t[f],u++;a[i]=c/u,i++,s=l}return a}(l,n)),f=new Blob([u],{type:a});this.postMessage({command:"exportWAV",data:f})}(l.data.type);break;case"getBuffer":!function(){let e=[];for(let n=0;n<t;n++)e.push(i(r[n],o));this.postMessage({command:"getBuffer",data:e})}();break;case"clear":o=0,r=[],a()}var c}}),{}),this.worker.postMessage({command:"init",config:{sampleRate:this.context.sampleRate,numChannels:this.config.numChannels}}),this.worker.onmessage=e=>{let t=this.callbacks[e.data.command].pop();"function"==typeof t&&t(e.data.data)}}record(){this.recording=!0}stop(){this.recording=!1}clear(){this.worker.postMessage({command:"clear"})}getBuffer(e){if(!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.getBuffer.push(e),this.worker.postMessage({command:"getBuffer"})}exportWAV(e,t){if(t=t||this.config.mimeType,!(e=e||this.config.callback))throw new Error("Callback not set");this.callbacks.exportWAV.push(e),this.worker.postMessage({command:"exportWAV",type:t})}static forceDownload(e,t){let n=(window.URL||window.webkitURL).createObjectURL(e),o=window.document.createElement("a");o.href=n,o.download=t||"output.wav";let r=document.createEvent("Event");r.initEvent("click",!0,!0),o.dispatchEvent(r)}}let m,w,v=g;async function b({audioContext:e,errHandler:t,onStreamLoad:n}){try{const t=await navigator.mediaDevices.getUserMedia({audio:!0});return n&&n(),m=t,w=e.createMediaStreamSource(t),v.worker&&v.worker.terminate(),v=new g(w),v.record(),t}catch(e){console.log(e),t&&t()}}function k({exportWAV:e,wavCallback:t}){v.stop(),m.getAudioTracks()[0].stop(),e&&t&&v.exportWAV((e=>t(e))),v.clear()}var y,x=-1!==navigator.userAgent.indexOf("Edg/"),A=window.AudioContext||window.webkitAudioContext,C=window.SpeechRecognition||window.webkitSpeechRecognition;function R(c){var f=this,h=c.continuous,p=c.crossBrowser,d=c.googleApiKey,g=c.googleCloudRecognitionConfig,m=c.onStartSpeaking,w=c.onStoppedSpeaking,v=c.speechRecognitionProperties,x=c.timeout,C=c.useOnlyGoogleCloud,R=void 0!==C&&C,S=e(!1),T=S[0],M=S[1],U=t(),W=e([]),E=W[0],B=W[1],H=e(),V=H[0],L=H[1],O=e(""),F=O[0],I=O[1],P=t(),j=t();n((function(){var e;p||y||I("Speech Recognition API is only available on Chrome"),(null===(e=null===navigator||void 0===navigator?void 0:navigator.mediaDevices)||void 0===e?void 0:e.getUserMedia)||I("getUserMedia is not supported on this device/browser :("),!p&&!R||d||console.error("No google cloud API key was passed, google API will not be able to process speech"),U.current||(U.current=new A)}),[]);var z=function(){return r(f,void 0,void 0,(function(){var e,t,n,o;return a(this,(function(r){switch(r.label){case 0:return!R&&y?(function(){if(y){h&&(y.continuous=!0);var e=v||{},t=e.grammars,n=e.interimResults,o=e.lang,r=e.maxAlternatives;t&&(y.grammars=t),o&&(y.lang=o),console.log("ChromeSpeechRecognition"),y.interimResults=n||!1,y.maxAlternatives=r||1,y.start(),y.onresult=function(e){var t=e.results[e.results.length-1],o=t[0].transcript;if(console.log("interimSetting",n),n)if(t.isFinal)L(void 0),B((function(e){return i(e,[o])}));else{for(var r="",a=e.resultIndex;a<e.results.length;a++)r+=e.results[a][0].transcript;L(r),console.log("interimResult",r)}else B((function(e){return i(e,[o])}))},y.onaudiostart=function(){return M(!0)},y.onend=function(){M(!1)}}}(),[2]):p||R?("suspended"===(null===(n=U.current)||void 0===n?void 0:n.state)&&(null===(o=U.current)||void 0===o||o.resume()),[4,b({errHandler:function(){return I("Microphone permission was denied")},audioContext:U.current})]):[2];case 1:return e=r.sent(),x&&_(),j.current&&j.current.getAudioTracks()[0].stop(),j.current=e.clone(),(t=function(e,t){var n=new l;if(!s)return n;var o,r,a,i=(t=t||{}).smoothing||.1,c=t.interval||50,f=t.threshold,h=t.play,p=t.history||10,d=!0;u=t.audioContext||u||new s,(a=u.createAnalyser()).fftSize=512,a.smoothingTimeConstant=i,r=new Float32Array(a.frequencyBinCount),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(o=u.createMediaElementSource(e),void 0===h&&(h=!0),f=f||-50):(o=u.createMediaStreamSource(e),f=f||-50),o.connect(a),h&&a.connect(u.destination),n.speaking=!1,n.suspend=function(){return u.suspend()},n.resume=function(){return u.resume()},Object.defineProperty(n,"state",{get:function(){return u.state}}),u.onstatechange=function(){n.emit("state_change",u.state)},n.setThreshold=function(e){f=e},n.setInterval=function(e){c=e},n.stop=function(){d=!1,n.emit("volume_change",-100,f),n.speaking&&(n.speaking=!1,n.emit("stopped_speaking")),a.disconnect(),o.disconnect()},n.speakingHistory=[];for(var g=0;g<p;g++)n.speakingHistory.push(0);var m=function(){setTimeout((function(){if(d){var e=function(e,t){var n=-1/0;e.getFloatFrequencyData(t);for(var o=4,r=t.length;o<r;o++)t[o]>n&&t[o]<0&&(n=t[o]);return n}(a,r);n.emit("volume_change",e,f);var t=0;if(e>f&&!n.speaking){for(var o=n.speakingHistory.length-3;o<n.speakingHistory.length;o++)t+=n.speakingHistory[o];t>=2&&(n.speaking=!0,n.emit("speaking"))}else if(e<f&&n.speaking){for(o=0;o<n.speakingHistory.length;o++)t+=n.speakingHistory[o];0==t&&(n.speaking=!1,n.emit("stopped_speaking"))}n.speakingHistory.shift(),n.speakingHistory.push(0+(e>f)),m()}}),c)};return m(),n}(j.current,{audioContext:U.current})).on("speaking",(function(){m&&m(),clearTimeout(P.current)})),t.on("stopped_speaking",(function(){var e;w&&w(),M(!1),null===(e=j.current)||void 0===e||e.getAudioTracks()[0].stop(),k({exportWAV:!0,wavCallback:function(e){return D({blob:e,continuous:h||!1})}})})),M(!0),[2]}}))}))},_=function(){P.current=window.setTimeout((function(){var e;M(!1),null===(e=j.current)||void 0===e||e.getAudioTracks()[0].stop(),k({exportWAV:!1})}),x)},D=function(e){var t=e.blob,n=e.continuous,s=new FileReader;s.readAsDataURL(t),s.onloadend=function(){return r(f,void 0,void 0,(function(){var e,t,r,l,c,u,f,h;return a(this,(function(a){switch(a.label){case 0:return e=s.result,(t=null===(f=U.current)||void 0===f?void 0:f.sampleRate)&&t>44100&&(t=44100),r={content:""},l=o({encoding:"LINEAR16",languageCode:"en-US",maxAlternatives:10,useEnhanced:!0,sampleRateHertz:t,speechContexts:[{phrases:["want","except the","all the remaining","except","that's it","and","take","all of them","want","would like to","would like","want to","need to","like to","rest is yours","you can have the rest","rest","offer","accept","give me","all remainings","all remaining","deal","yes","agree","everything","you can","I can give"],boost:35},{phrases:["zero","one","two","three","four","one apple","two apple","two apples","three apple","three apples","four apple","four apples","one banana","two banana","two bananas","three banana","three bananas","four banana","four bananas","one orange","two orange","two oranges","three orange","three oranges","four orange","four oranges","one watermelon","two watermelon","two watermelons","three watermelon","three watermelons","four watermelon","four watermelons","all apples","all oranges","all bananas","all watermelons","all of apples","all of oranges","all of bananas","all of watermelons","all of the apples","all of the oranges","all of the bananas","all of the watermelons","zero apple","zero orange","zero banana","zero watermelon","all of them"],boost:45}]},g),c={config:l,audio:r},r.content=e.substr(e.indexOf(",")+1),[4,fetch("https://speech.googleapis.com/v1p1beta1/speech:recognize?key="+d,{method:"POST",body:JSON.stringify(c)})];case 1:return[4,a.sent().json()];case 2:return u=a.sent(),(null===(h=u.results)||void 0===h?void 0:h.length)>0&&B((function(e){return i(e,[u.results[0].alternatives.reduce((function(e,t){return e.confidence>t.confidence?e:t})).transcript])})),n&&z(),[2]}}))}))}};return{error:F,interimResult:V,isRecording:T,results:E,startSpeechToText:z,stopSpeechToText:function(){var e;y&&!R?y.stop():(M(!1),null===(e=j.current)||void 0===e||e.getAudioTracks()[0].stop(),k({exportWAV:!0,wavCallback:function(e){return D({blob:e,continuous:!1})}}))}}}navigator.brave&&navigator.brave.isBrave().then((function(e){e&&(y=null)})),!x&&C&&(y=new C);export default R;
//# sourceMappingURL=index.js.map
